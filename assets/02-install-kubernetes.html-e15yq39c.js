import{_ as s,c as e,o as n,d as a}from"./app-BMZpApWF.js";const t={},i=a(`<h1 id="kubernetes-install" tabindex="-1"><a class="header-anchor" href="#kubernetes-install"><span>Kubernetes install</span></a></h1><p>Load <strong>overlay</strong> and <strong>br_netfilter</strong> modules</p><p>Create file <strong>/etc/modules-load.d/containerd.conf</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">overlay</span>
<span class="line">br_netfilter</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Manual load</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">$ <span class="token function">sudo</span> modprobe overlay</span>
<span class="line">$ <span class="token function">sudo</span> modprobe br_netfilter</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Create file /etc/sysctl.d/99-kubernetes-k8s.conf</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">net.ipv4.ip_forward <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Load configs created</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">$ <span class="token function">sudo</span> <span class="token function">sysctl</span> <span class="token parameter variable">--system</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Install containerd</p><p>Install <strong>docker</strong> repository only to install <strong>containerd.io</strong></p><p>Download gpg key by repository</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://download.docker.com/linux/ubuntu/gpg <span class="token operator">|</span> <span class="token function">sudo</span> gpg <span class="token parameter variable">--dearmor</span> <span class="token parameter variable">-o</span> /etc/apt/trusted.gpg.d/docker.gpg</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Create repository file in <strong>/etc/apt/sources.list.d/</strong> with name <strong>docker.list</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">deb <span class="token punctuation">[</span>arch<span class="token operator">=</span>amd64<span class="token punctuation">]</span> https://download.docker.com/linux/debian bullseye stable</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Update package list and install <strong>containerd.io</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">apt-get</span> update</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> containerd.io</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Overwrite containerd config file</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">$ <span class="token function">sudo</span> containerd config default <span class="token operator">&gt;</span> /etc/containerd/config.toml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Edit file <strong>/etc/containerd/config.toml</strong> and change the option <strong>SystemdCgroup</strong> from <strong>false</strong> to <strong>true</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/containerd/config.toml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Restart the containerd</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> systemctl restart containerd</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Install the Kubernetes</p><p>Add repository kubernetes gpg key</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://pkgs.k8s.io/core:/stable:/v1.31/deb/Release.key <span class="token operator">|</span> gpg <span class="token parameter variable">--dearmor</span> <span class="token parameter variable">-o</span> /etc/apt/trusted.gpg.d/kubernetes-gpg-keyring.gpg</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Add kubernetes repository</p><p>Create file: <strong>/etc/apt/sources.list.d/kubernetes.list</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">deb <span class="token punctuation">[</span>signed-by<span class="token operator">=</span>/etc/apt/trusted.gpg.d/kubernetes-gpg-keyring.gpg<span class="token punctuation">]</span> http://pkgs.k8s.io/core:/stable:/v1.31/deb /&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="" tabindex="-1"><a class="header-anchor" href="#"><span></span></a></h3><p>Update package list</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">apt</span> update</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Install kubernetes</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> kubelet kubeadm</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Mark hold packages</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> apt-mark hold kubelet kubeadm</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Active the daemon to autostart</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> kubelet</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Limit image storage</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">vim</span> /var/lib/kubelet/kubeadm-flags.env</span>
<span class="line"></span>
<span class="line">--image-gc-high-threshold<span class="token operator">=</span><span class="token number">60</span> --image-gc-low-threshold<span class="token operator">=</span><span class="token number">50</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,41),l=[i];function r(d,p){return n(),e("div",null,l)}const c=s(t,[["render",r],["__file","02-install-kubernetes.html.vue"]]),u=JSON.parse('{"path":"/kubernetes/02-install-kubernetes.html","title":"Kubernetes install","lang":"en-US","frontmatter":{},"headers":[{"level":3,"title":"","slug":"","link":"#","children":[]}],"git":{"updatedTime":1748002949000,"contributors":[{"name":"Celso Nery","email":"celso.nery@gmail.com","commits":3}]},"filePathRelative":"kubernetes/02-install-kubernetes.md"}');export{c as comp,u as data};
