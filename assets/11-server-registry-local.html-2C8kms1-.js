import{_ as e,c as a,o as s,e as n}from"./app-D7xdoRJX.js";const i={},t=n(`<h1 id="criando-um-repositorios-local" tabindex="-1"><a class="header-anchor" href="#criando-um-repositorios-local"><span>Criando um reposit칩rios local</span></a></h1><h2 id="configuracoes-iniciais" tabindex="-1"><a class="header-anchor" href="#configuracoes-iniciais"><span>Configura칞칫es iniciais</span></a></h2><blockquote><p>Realize a configura칞칚o no servidor e em todos os n칩s. OBS.: Configura칞칚o somente para teste, usar certificado o conex칚o TLS para produ칞칚o.</p></blockquote><blockquote><p>Acrescente no arquivo <strong>/etc/docker/daemon.json</strong> host: ip ou nome da maquina onde est치 o registry e port: a porta 游땥</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">{</span>
<span class="line">    &quot;insecure-registries&quot;: [ &quot;host:port&quot; ]</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Reinicie o servi칞o docker</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line"># systemctl restart docker</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="criar-o-servidor" tabindex="-1"><a class="header-anchor" href="#criar-o-servidor"><span>Criar o servidor</span></a></h2><blockquote><p>Para criar um servidor local precisamos criar um container com a imagem registry com o nome que desejarmos.</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">$ docker run -d -p 5000:5000 --restart=always --name=repositorio registry</span>
<span class="line"></span>
<span class="line">-d                  &lt;- rodar como daemon</span>
<span class="line">-p 5000:5000        &lt;- porta</span>
<span class="line">--restart=always    &lt;- auto reiniciar se falhar</span>
<span class="line">--name=repositorio  &lt;- nome do repositorio</span>
<span class="line">registry            &lt;- imagem docker para o servidor </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="testando-se-o-registry-esta-funcionando" tabindex="-1"><a class="header-anchor" href="#testando-se-o-registry-esta-funcionando"><span>Testando se o registry est치 funcionando</span></a></h2><blockquote><p>Aceese via browser</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">http://registry.zion.local:5000/v2/</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="tageando-uma-imagem" tabindex="-1"><a class="header-anchor" href="#tageando-uma-imagem"><span>Tageando uma imagem</span></a></h2><p>Listando as imagens</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">$ docker image ls</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Tageando a imagem <strong>oregontecnologia/myapp-api</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">$ docker tag oregontecnologia/myapp-api registry.zion.local:5000/myapp-api</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Subir a imagem</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">$ docker push registry.zion.local:5000/myapp-api</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Rodando um container kubernetes com a imagem do servidor local</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">$ kubectl create deploy myapp-api --image=registry.zion.local:5000/myapp-api</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Verifique se est치 rodando</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">$ kubectl get pods -o wide</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h1 id="servidor-remoto" tabindex="-1"><a class="header-anchor" href="#servidor-remoto"><span>Servidor remoto</span></a></h1><h3 id="criando-autenticacao-com-htpasswd" tabindex="-1"><a class="header-anchor" href="#criando-autenticacao-com-htpasswd"><span>Criando autentica칞칚o com htpasswd</span></a></h3><p>Instalando apache2-utils para utilizar htpasswd</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">$ sudo apt install apache2-utils</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Crie uma pasta auth na pasta home do usu치rio e entrar nela</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">$ mkdir ~/home-user/auth &amp;&amp; cd $_</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Crie o arquivo registry.password com a flag &#39;-c&#39; adicionando o usuario &#39;nome_usuario&#39; criptotagrafando com -B</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">$ htpasswd -Bc registry.password nome_usu치rio</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Caso queira criar mais usu치rios n칚o utilizar o &#39;-c&#39;</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">$ htpasswd -B registry.password nome_do_novo_usu치rio</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="autenticando-e-verificando-se-esta-funcionando" tabindex="-1"><a class="header-anchor" href="#autenticando-e-verificando-se-esta-funcionando"><span>Autenticando e verificando se est치 funcionando</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">http://nome-ou-ip-do-servidor:5000/v2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="usando-docker-compose-yaml" tabindex="-1"><a class="header-anchor" href="#usando-docker-compose-yaml"><span>Usando docker-compose.yaml</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">$ vim docker-compose.yml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">registry</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> registry<span class="token punctuation">:</span><span class="token number">2</span></span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token string">&quot;5000:5000&quot;</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">REGISTRY_AUTH</span><span class="token punctuation">:</span> htpasswd</span>
<span class="line">      <span class="token key atrule">REGISTRY_AUTH_HTPASSWD_REALM</span><span class="token punctuation">:</span> Registry</span>
<span class="line">      <span class="token key atrule">REGISTRY_AUTH_HTPASSWD_PATH</span><span class="token punctuation">:</span> /auth/registry.password</span>
<span class="line">      <span class="token key atrule">REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY</span><span class="token punctuation">:</span> /data</span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> ./auth<span class="token punctuation">:</span>/auth</span>
<span class="line">      <span class="token punctuation">-</span> ./data<span class="token punctuation">:</span>/data</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Subindo o servi칞o registry</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">$ docker-compose up</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,41),r=[t];function l(o,d){return s(),a("div",null,r)}const p=e(i,[["render",l],["__file","11-server-registry-local.html.vue"]]),u=JSON.parse('{"path":"/kubernetes/11-server-registry-local.html","title":"Criando um reposit칩rios local","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Configura칞칫es iniciais","slug":"configuracoes-iniciais","link":"#configuracoes-iniciais","children":[]},{"level":2,"title":"Criar o servidor","slug":"criar-o-servidor","link":"#criar-o-servidor","children":[]},{"level":2,"title":"Testando se o registry est치 funcionando","slug":"testando-se-o-registry-esta-funcionando","link":"#testando-se-o-registry-esta-funcionando","children":[]},{"level":2,"title":"Tageando uma imagem","slug":"tageando-uma-imagem","link":"#tageando-uma-imagem","children":[{"level":3,"title":"Criando autentica칞칚o com htpasswd","slug":"criando-autenticacao-com-htpasswd","link":"#criando-autenticacao-com-htpasswd","children":[]},{"level":3,"title":"Autenticando e verificando se est치 funcionando","slug":"autenticando-e-verificando-se-esta-funcionando","link":"#autenticando-e-verificando-se-esta-funcionando","children":[]}]},{"level":2,"title":"Usando docker-compose.yaml","slug":"usando-docker-compose-yaml","link":"#usando-docker-compose-yaml","children":[]}],"git":{"updatedTime":1732281297000,"contributors":[{"name":"Celso Nery","email":"celso.nery@gmail.com","commits":1}]},"filePathRelative":"kubernetes/11-server-registry-local.md"}');export{p as comp,u as data};
