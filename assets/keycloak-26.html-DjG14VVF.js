import{_ as e,c as a,o as s,a as n}from"./app-h7mth2r0.js";const l={},i=n(`<h1 id="keycloak-26" tabindex="-1"><a class="header-anchor" href="#keycloak-26"><span>Keycloak 26</span></a></h1><h2 id="install-java" tabindex="-1"><a class="header-anchor" href="#install-java"><span>Install Java</span></a></h2><p>Primeiramento instale o OpenJDK-17</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># apt install openjdk-17-jre-headless</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="install-keycloak" tabindex="-1"><a class="header-anchor" href="#install-keycloak"><span>Install keycloak</span></a></h2><h3 id="download-keycloak" tabindex="-1"><a class="header-anchor" href="#download-keycloak"><span>Download Keycloak</span></a></h3><ul><li>Faça o download do keycloak OBS: Aqui estou usando a versão 26.0.2</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># wget -c https://github.com/keycloak/keycloak/releases/download/26.0.2/keycloak-26.0.2.tar.gz</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>Unpack keycloak</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># tar zxvf keycloak-26.0.2.tar.gz</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Eu movi a pasta extraida <strong>keycloak-26.0.2</strong> para <strong>/opt/keycloak</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># mv keycloak-26.0.2 /opt/keycloak</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="generate-ssl-to-keycloak" tabindex="-1"><a class="header-anchor" href="#generate-ssl-to-keycloak"><span>Generate SSL to keycloak</span></a></h3><blockquote><p>Utilizei um certificado Let&#39;s Encrypt</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">certbot <span class="token parameter variable">-v</span> certonly <span class="token parameter variable">--standalone</span> <span class="token parameter variable">-d</span> auth.bagarote.dev.br</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Foi criado em **/etc/letsencrypt/live/auth.bagarote.dev.br/*.pem</p><h3 id="configuration-keycloak" tabindex="-1"><a class="header-anchor" href="#configuration-keycloak"><span>Configuration keycloak</span></a></h3><ul><li>Editei o arquivo <strong>/opt/keycloak/conf/keycloak.conf</strong> e alterei as seguintes variáveis</li></ul><div class="language-conf line-numbers-mode" data-highlighter="prismjs" data-ext="conf" data-title="conf"><pre><code><span class="line"># Observability</span>
<span class="line"></span>
<span class="line"># If the server should expose healthcheck endpoints.</span>
<span class="line">health-enabled=true</span>
<span class="line"></span>
<span class="line"># If the server should expose metrics endpoints.</span>
<span class="line">metrics-enabled=true</span>
<span class="line"></span>
<span class="line"># HTTP</span>
<span class="line"></span>
<span class="line"># The file path to a server certificate or certificate chain in PEM format.</span>
<span class="line">https-certificate-file=/etc/letsencrypt/live/auth.bagarote.dev.br/fullchain.pem</span>
<span class="line"></span>
<span class="line"># The file path to a private key in PEM format.</span>
<span class="line">https-certificate-key-file=/etc/letsencrypt/live/auth.bagarote.dev.br/privkey.pem</span>
<span class="line"></span>
<span class="line"># The proxy address forwarding mode if the server is behind a reverse proxy.</span>
<span class="line">#proxy=reencrypt</span>
<span class="line"></span>
<span class="line"># Do not attach route to cookies and rely on the session affinity capabilities from reverse proxy</span>
<span class="line">#spi-sticky-session-encoder-infinispan-should-attach-route=false</span>
<span class="line"></span>
<span class="line"># Hostname for the Keycloak server.</span>
<span class="line">hostname=auth.bagarote.dev.br</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="build-keycloak" tabindex="-1"><a class="header-anchor" href="#build-keycloak"><span>Build keycloak</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">/opt/keycloak/bin/kc.sh build</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="running-keycloak" tabindex="-1"><a class="header-anchor" href="#running-keycloak"><span>Running keycloak</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">KEYCLOAK_ADMIN</span><span class="token operator">=</span>admin</span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">KEYCLOAK_ADMIN_PASSWORD</span><span class="token operator">=</span>senhadoadmin</span>
<span class="line"></span>
<span class="line">/opt/keycloak/bin/kc.sh start</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="criei-um-service-no-systemd-para-facilitar-o-gerenciamento" tabindex="-1"><a class="header-anchor" href="#criei-um-service-no-systemd-para-facilitar-o-gerenciamento"><span>Criei um service no systemd para facilitar o gerenciamento</span></a></h2><p>Em <strong>/etc/systemd/system/</strong> criei <strong>keycloak.service</strong> com o seguinte conteúdo</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span></span>
<span class="line"><span class="token assign-left variable">Description</span><span class="token operator">=</span>Manager <span class="token function">service</span> keycloak</span>
<span class="line"><span class="token assign-left variable">After</span><span class="token operator">=</span>multi-user.target</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>Service<span class="token punctuation">]</span></span>
<span class="line"><span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/bin/bash /opt/keycloak/bin/kc.sh start</span>
<span class="line"><span class="token assign-left variable">Type</span><span class="token operator">=</span>simple</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>Install<span class="token punctuation">]</span></span>
<span class="line"><span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Após a criação do arquivo instalei para iniciar sempre junto com a máquina</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># systemctl enable --now keycloak.service</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="teste-funcionamento" tabindex="-1"><a class="header-anchor" href="#teste-funcionamento"><span>Teste funcionamento</span></a></h2><blockquote><p>Abra seu browser no endereço criado para o keycloak na porta :8443 Ex: auth.bagarote.dev.br:8443</p></blockquote>`,30),t=[i];function c(r,o){return s(),a("div",null,t)}const p=e(l,[["render",c],["__file","keycloak-26.html.vue"]]),u=JSON.parse('{"path":"/keycloak/keycloak-26.html","title":"Keycloak 26","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Install Java","slug":"install-java","link":"#install-java","children":[]},{"level":2,"title":"Install keycloak","slug":"install-keycloak","link":"#install-keycloak","children":[{"level":3,"title":"Download Keycloak","slug":"download-keycloak","link":"#download-keycloak","children":[]},{"level":3,"title":"Generate SSL to keycloak","slug":"generate-ssl-to-keycloak","link":"#generate-ssl-to-keycloak","children":[]},{"level":3,"title":"Configuration keycloak","slug":"configuration-keycloak","link":"#configuration-keycloak","children":[]},{"level":3,"title":"Build keycloak","slug":"build-keycloak","link":"#build-keycloak","children":[]},{"level":3,"title":"Running keycloak","slug":"running-keycloak","link":"#running-keycloak","children":[]}]},{"level":2,"title":"Criei um service no systemd para facilitar o gerenciamento","slug":"criei-um-service-no-systemd-para-facilitar-o-gerenciamento","link":"#criei-um-service-no-systemd-para-facilitar-o-gerenciamento","children":[]},{"level":2,"title":"Teste funcionamento","slug":"teste-funcionamento","link":"#teste-funcionamento","children":[]}],"git":{"updatedTime":1748361051000,"contributors":[{"name":"Celso Nery","email":"celso.nery@gmail.com","commits":1}]},"filePathRelative":"keycloak/keycloak-26.md"}');export{p as comp,u as data};
