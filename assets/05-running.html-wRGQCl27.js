import{_ as s,r as i,c as l,a as t,b as e,d,w as r,e as a,o}from"./app-CTpZyuN8.js";const c={},p=a(`<h1 id="colocando-para-funcionar" tabindex="-1"><a class="header-anchor" href="#colocando-para-funcionar"><span>Colocando para funcionar</span></a></h1><h4 id="criando-imagem-docker-local-para-o-container" tabindex="-1"><a class="header-anchor" href="#criando-imagem-docker-local-para-o-container"><span>Criando imagem Docker local para o container</span></a></h4><blockquote><p>Utilizei neste exemplo uma api rest myapp.war feito em SpringBoot para facil entendimento</p></blockquote><p>Crie o arquivo <strong>Dockerfile</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">FROM alpine</span>
<span class="line">WORKDIR /opt/app</span>
<span class="line">RUN apk update &amp;&amp; apk add vim openjdk11-jre</span>
<span class="line">COPY runapp.sh .</span>
<span class="line">CMD ash runapp.sh</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Construa a imagem docker</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">docker image build -t oregontecnologia/myapp-api:1.0.0 .</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,7),u=a(`<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">docker login</span>
<span class="line"></span>
<span class="line">username:</span>
<span class="line">password:</span>
<span class="line"></span>
<span class="line">docker push oregontecnologia/myapp-api:1.0.0</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Verifique se está rodando</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">kubectl get pods -o wide</span>
<span class="line">kubectl get deploy -o wide</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Crie um container com a imagem criada</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">kubectl create deploy myapp-deploy --image=oregontecnologia/myapp-api:1.0.0</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Crie um serviço para acesso externo a aplicação</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">kubectl expose deploy myapp-deploy --type=LoadBalancer --external-ip=10.0.10.100 --port=80</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Para remover a aplicação</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">kubectl delete deploy myapp-deploy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="atualizando-e-voltando-uma-versao-da-aplicacao" tabindex="-1"><a class="header-anchor" href="#atualizando-e-voltando-uma-versao-da-aplicacao"><span>Atualizando e voltando uma versão da aplicação.</span></a></h3><p>Para atualizar a aplicação</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">kubectl set image deployments/myapp-deploy myapp-api=oregontecnologia/myapp-api:1.0.2 --record</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Para voltar uma atualização</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">kubectl rollout undo deployments/myapp-deploy</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="escalando-a-aplicacao" tabindex="-1"><a class="header-anchor" href="#escalando-a-aplicacao"><span>Escalando a aplicação</span></a></h3><p>Escalando manualmente 3 replicas do container</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">kubectl scale deploy myapp-deploy --replicas=3</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Escalando automaticamente iniciando com 2 replicas até 15 réplicas escalando quando a CPU atingir 75% de utilização.</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">kubectl autoscale deploy myapp-deploy --min=2 --max=10 --cpu-percent=75</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Para verificar o autoscale</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">kubectl get hpa</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Para remover o autoscale</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">kubectl delete hpa myapp-deploy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,23);function m(v,h){const n=i("RouteLink");return o(),l("div",null,[p,t("p",null,[e("Transfira a imagem para o dockerhub ou "),d(n,{to:"/kubernetes/11-server-registry-local.html"},{default:r(()=>[e("Crie um servidor de respositório local")]),_:1})]),u])}const g=s(c,[["render",m],["__file","05-running.html.vue"]]),x=JSON.parse('{"path":"/kubernetes/05-running.html","title":"Colocando para funcionar","lang":"en-US","frontmatter":{},"headers":[{"level":3,"title":"Atualizando e voltando uma versão da aplicação.","slug":"atualizando-e-voltando-uma-versao-da-aplicacao","link":"#atualizando-e-voltando-uma-versao-da-aplicacao","children":[]},{"level":3,"title":"Escalando a aplicação","slug":"escalando-a-aplicacao","link":"#escalando-a-aplicacao","children":[]}],"git":{"updatedTime":1732281297000,"contributors":[{"name":"Celso Nery","email":"celso.nery@gmail.com","commits":1}]},"filePathRelative":"kubernetes/05-running.md"}');export{g as comp,x as data};
