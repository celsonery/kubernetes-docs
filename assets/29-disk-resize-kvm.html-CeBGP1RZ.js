import{_ as e,c as s,o as a,e as n}from"./app-BzyLCCjA.js";const i={},l=n(`<h1 id="resize-kvm-disk-with-lvm" tabindex="-1"><a class="header-anchor" href="#resize-kvm-disk-with-lvm"><span>Resize KVM Disk with LVM</span></a></h1><h2 id="_1-resizing-disk-in-kvm" tabindex="-1"><a class="header-anchor" href="#_1-resizing-disk-in-kvm"><span>1 - Resizing disk in KVM</span></a></h2><p>Listar vms rodando</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">virsh</span> list</span>
<span class="line">OR</span>
<span class="line"><span class="token function">virsh</span> list <span class="token parameter variable">--all</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Desligar a maquina virtual</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">virsh</span> <span class="token function">shutdown</span> kdocker</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Verificar qual disco pertence a maquina</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">virsh</span> domblklist kdocker</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Verificar informações sobre o disco</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">qemu-img info /var/lib/libvirt/images/kdocker.qcow2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><p>OBS.: Se houver algum snapshot - remover Listar</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">virsh</span> snapshot-list kdocker</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Remover</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">virsh</span> snapshot-delete <span class="token parameter variable">--domain</span> kdocker <span class="token parameter variable">--snapshotname</span> snapshot1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><p>Aumentar o disco com mais 50G</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">qemu-img resize /var/lib/libvirt/images/kdocker.qcow2 +50G</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Iniciar a maquina virtual</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">virsh</span> start kdocker</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Informar ao KVM aumento do disco</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">virsh</span> blockresize k8sno3 /var/lib/libvirt/images/k8sno3.qcow2 80G <span class="token operator">&lt;</span>- novo tamanho total <span class="token keyword">do</span> disco</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_2-resizing-disk-inside-the-vm-with-lvm" tabindex="-1"><a class="header-anchor" href="#_2-resizing-disk-inside-the-vm-with-lvm"><span>2 - Resizing disk inside the VM with LVM</span></a></h2><p>Conectar na VM</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">ssh</span> kdocker</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Confirmar tamanho do disco</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">df</span> <span class="token parameter variable">-hT</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Aumentar partição com fdisk</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">fdisk</span> /dev/vda</span>
<span class="line"></span>
<span class="line">passos:</span>
<span class="line">p </span>
<span class="line">d -<span class="token operator">&gt;</span> <span class="token number">2</span></span>
<span class="line">n -<span class="token operator">&gt;</span> e</span>
<span class="line">p</span>
<span class="line">n -<span class="token operator">&gt;</span> l -<span class="token operator">&gt;</span> N</span>
<span class="line">x -<span class="token operator">&gt;</span> b</span>
<span class="line">r</span>
<span class="line">t -<span class="token operator">&gt;</span> 8e</span>
<span class="line">w</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Usar o partprobe não é necessário reinicialização da VM</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">apt</span> <span class="token function">install</span> <span class="token function">parted</span></span>
<span class="line">partprobe /dev/vda</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Verificar se existe espaço livre</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">lvs</span>
<span class="line">pvs</span>
<span class="line">vgs</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Autmentar Phisical Volume no LVM</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">pvresize /dev/vda5</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Verificar novamente se existe espaço livre</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">vgs</span>
<span class="line">pvs</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Em caso positivo, utilizar espaço livre para partição var neste caso.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">lvextend <span class="token parameter variable">-l</span> +100%FREE /dev/mapper/k8s01--vg-var</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Por final aumentar sistema de arquivos</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">resize2fs /dev/k8s01-vg/var</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Verificar finalmente o novo tamanho do disco</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">df</span> <span class="token parameter variable">-Th</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h1 id="reduce-lvm-volume" tabindex="-1"><a class="header-anchor" href="#reduce-lvm-volume"><span>Reduce LVM Volume</span></a></h1><p>OBS.: Para o volume root é necessário bootar via live-cd</p><p>Caso precise montar volumes LVMs</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">vgchange <span class="token parameter variable">-ay</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="reduzinho-um-volume-raiz" tabindex="-1"><a class="header-anchor" href="#reduzinho-um-volume-raiz"><span>Reduzinho um volume raiz</span></a></h4><p>1 - Verificação do volume</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">e2fsck <span class="token parameter variable">-fy</span> /dev/mapper/k8s01--vg-root</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>2 - Reduzir sistema de arquivos para 10G</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">resize2fs /dev/mapper/k8s01--vg-root 10G</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>3 - Reduzir volume lógico para os 10G</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">lvreduce <span class="token parameter variable">-L</span> 10G /dev/mapper/k8s01--vg-root</span>
<span class="line"></span>
<span class="line">ou reduzir espaço</span>
<span class="line"></span>
<span class="line">lvreduce <span class="token parameter variable">-L</span> +10G /dev/mapper/k8s01--vg-root</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4 - Executar resize2fs novamente</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">resize2fs /dev/mapper/k8s01--vg-root</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>5 - Reboot</p><h4 id="reduzinho-um-volume-nao-raiz-ex-var" tabindex="-1"><a class="header-anchor" href="#reduzinho-um-volume-nao-raiz-ex-var"><span>Reduzinho um volume não raiz ex.: /var</span></a></h4><p>1 - Desmontar partição / Volume</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">umount</span> /var</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>2 - Verificação do volume</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">e2fsck <span class="token parameter variable">-fy</span> /dev/mapper/k8s01--vg-var</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>3 - Reduzir sistema de arquivos para 10G</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">resize2fs /dev/mapper/k8s01--vg-var 10G</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>4 - Reduzir volume lógico para os 10G</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">lvreduce <span class="token parameter variable">-L</span> 10G /dev/mapper/k8s01--vg-var</span>
<span class="line"></span>
<span class="line">ou reduzir espaço</span>
<span class="line"></span>
<span class="line">lvreduce <span class="token parameter variable">-L</span> <span class="token parameter variable">-10G</span> /dev/mapper/k8s01--vg-root</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>5 - Executar resize2fs novamente</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">resize2fs /dev/mapper/k8s01--vg-root</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>6 - Remontar partição/volume</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">mount</span> /var</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,70),r=[l];function d(t,p){return a(),s("div",null,r)}const o=e(i,[["render",d],["__file","29-disk-resize-kvm.html.vue"]]),v=JSON.parse('{"path":"/kubernetes/29-disk-resize-kvm.html","title":"Resize KVM Disk with LVM","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"1 - Resizing disk in KVM","slug":"_1-resizing-disk-in-kvm","link":"#_1-resizing-disk-in-kvm","children":[]},{"level":2,"title":"2 - Resizing disk inside the VM with LVM","slug":"_2-resizing-disk-inside-the-vm-with-lvm","link":"#_2-resizing-disk-inside-the-vm-with-lvm","children":[]}],"git":{"updatedTime":1747956638000,"contributors":[{"name":"Celso Nery","email":"celso.nery@gmail.com","commits":3}]},"filePathRelative":"kubernetes/29-disk-resize-kvm.md"}');export{o as comp,v as data};
